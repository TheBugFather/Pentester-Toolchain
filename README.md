<div align="center" style="font-family: monospace">
<h1>Pentester-Toolchain</h1>
&#9745;&#65039; Bandit verified &nbsp;|&nbsp; &#9745;&#65039; Synk verified &nbsp;|&nbsp; &#9745;&#65039; Pylint verified 9.71/10
<br><br>

![alt text](https://github.com/ngimb64/Pentester-Toolchain/blob/main/PentesterToolchain.png?raw=true)<br>
![alt text](https://github.com/ngimb64/Pentester-Toolchain/blob/main/Diagram_Pentester-Toolchain.png?raw=true)
</div>

## **Notice**
> This tool may be used for legal purposes only.<br>
> Users take full responsibility for any actions performed using this tool.<br>
> The author accepts no liability for damage caused by this tool.<br>
> If these terms are not acceptable to you, then do not use this tool.

## Purpose
Pentester Toolchain is pentesters templating system for automating toolchains for reconnaissance and
other purposes. It enables pentesters without coding skills to automate commonly used tools and
custom programs while utilizing parallel processing to run scans on multiple hosts simultaneously,
save the output, and convert to markdown in a reporting friendly fashion.

## Features
- easy to use and understand how to use
- integrates with local shell environment
- simple yaml config file to easily configure fully customizable toolchains of system binaries and custom programs
- parallel host scanning with multiprocessing, allocating one host per core
- ping scan integration and reactive regex system to execute toolchains based on open ports from nmap output
- ability to skip port scanning and automate toolchains on ports of existing targets
- reporting friendly markdown support

## Service Methodology
Also included is the [Network Service Methodology Guide](Service%20Methodology.md), which integrates
in Obsidian and provides recommended tooling associated with enumerated ports


### License
The program is licensed under [GNU Public License v3.0](LICENSE.md)

### Contributions or Issues
[CONTRIBUTING](CONTRIBUTING.md)

## Prereqs
Written in Python 3.10.6 for Kali Linux Debian-based OS. Git is required for associated submodules.<br>
After Python is installed, ensure the folowing command below is run to ensure all apt packages are installed:<br>
`sudo apt install -y awscli enum4linux glusterfs-cli ident-user-enum ike-scan nfs-common ntpq oscanner rshclient rusers`

## Installation
- Run the setup.py script to build a virtual environment and install any external packages in the created venv.

> Examples:<br> 
>       &emsp;&emsp;- Linux:  `python3 setup.py venv`

- Once virtual env is built traverse to the bin directory in the environment folder just created.
- In the venv/bin directory, execute `source activate` to activate the virtual environment.
- If for some reason issues are experienced with the setup script, the alternative is to manually create an environment, activate it, then run pip install -r packages.txt in project root (direct path reference to venv pip may be necessary).
- To exit from the virtual environment when finished, execute `deactivate`.

Run the following command to ensure python scripts are installed:<br>
`pip install -U pip`
`pip install mailspoof`

Before executing the program, a few git commands need to be run to ensure the submodules are installed:<br>
> git submodule init <br>
> git submodule update


## How to use
Once prerequisites have been met and installation is complete, follow the instructions in the
instructions.yml file; which are mapped to the config.yml default script file to provide examples.
If customization is desired, make a copy of the default config.yml or the blank.yml file to start from scratch.<br><br>
Once the configuration file is set, simply run:<br>
`python3 pentester_toolchain.py <config_file>`

If root permissions are needed for associated tools, run:<br>
`sudo ./venv/bin/python3 pentester_toolchain.py <config_file>`

**Note**:  The default configuration file requires root permissions to execute nmap scans

If a config file arg is not provided the user will be asked for one when the program starts.<br>

**Important Note** Depending on cpu availability, at times the program will exit quickly without
fully executing, which is simply fixed by running the program again until it catches.


## Output format
Generated output is organized by host in following order with handler output mapped identical to [Supported Service Ports](#supported-service-ports):
> &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;Nmap<br>
> Output -> host -> TCP_Handlers<br>
> &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;UDP_Handlers<br>
> &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;TCP_UDP_Handlers<br>

**Note**: Tools like gobuster can create extra directories inside the project folder, simply delete them when finished


## Supported Service Ports

### TCP Ports

---
20,21 - FTP <br>
22 - SSH <br>
23 - Telnet <br>
25,465,587,2525 - SMTP <br>
43 - Whois <br>
79 - Finger <br>
80,443,8080,8443 - HTTP/HTTPS <br>
110,995 - Pop3/Pop3 over TLS <br>
113 - Ident <br>
119,433 - NNTP/NNTPS (Network News Transport Protocol) <br>
143,993 - IMAP/IMAP over TLS <br>
199 - SNMP Smux <br>
264 - Checkpoint-Firewall <br>
445 - SMB <br>
502 - Modbus <br>
513 - Rlogin <br>
514 - Rsh <br>
548 - Apple Filing Protocol (AFP) <br>
554 - RTSP (Real Time Streaming Protocol) <br>
631 - Cups (IPP) <br>
873 - rsync <br>
1050,1098,1099 - Java RMI <br>
1433 - MsSQL database <br>
1521 - Oracle database (TNS listener) <br>
1883 - Mosquito <br>
2100 - Oracle XML DB FTP <br>
2375,2376 - Docker <br>
3128 - Squid <br>
3260 - ISCSI <br>
3299 - SAPRouter <br>
3306 - MySQL database <br>
3389 - Remote Desktop Protocol (RDP) <br>
3632 - distcc <br>
3690 - Subversion (svn server) <br>
4369 - Erlang Port Mapper Daemon (epmd) <br>
4786 - Cisco Smart Install <br>
5432,5433 - Postgresql <br>
5439 - Redshift <br>
5800,5900 - VNC <br>
5985,5986 - Winrm (Windows Remote Management) <br>
6000 - X11 <br>
6379 - Redis <br>
8000 - Java Debug Wire <br>
8009 - Apache JServ (AJP) <br>
8086 - InfluxDB <br>
8333,18333,18444,38333 - Bitcoin <br>
9042,9160 - Apache Cassandra <br>
9100 - Raw printing (JetDirect, AppSocket, PDL-Datastream) <br>
9200 - Elasticsearch <br>
10000 - Network Data Management Protocol (NDMP) <br>
11210 - Memcache <br>
24007,24008,24009,49152 - GlusterFS <br>
27017,27018 - MongoDB <br>
50030,50060,50070,50075,50090 - Hadoop <br>
<br>

### UDP Ports

---
67 - DHCP <br>
69 - TFTP <br>
1026 - Rusersd <br>
3702 - WS-Discovery <br>
5353 - mDNS<br>
47808 - BACNet <br>
<br>

### TCP/UDP Ports

---
53 - DNS <br>
88 - Kerberos <br>
111 - Rpcbind <br>
123 - NTP <br>
135 - MSRPC <br>
137,138,139 - Netbios <br>
161,162,10161,10162 - SNMP <br>
194,529,6667 - IRC <br>
389,636,3268,3269 - Ldap <br>
500,1723 - IPsec / IKE VPN / Point-to-Point Tunnel Protocol <br>
623 - Intelligent Platform Management Interface (IPMI) <br>
1080 - Socks Proxy <br>
2049 - NFS <br>
5671,5672 - RabbitMQ (AMQP) <br>
5984,6984 - CouchDB <br>
44818 - EthernetIP <br>
<br>


## Function Layout
-- pentest_automater.py --
> nmap_handler &nbsp;-&nbsp; Command execution function for nmap initial probing scans.

> scan_process &nbsp;-&nbsp; Begins by setting up process logging facilities, file paths, and
> directories. If there are no specified ports in config file, nmap scans will be skipped assuming
> the ports have already been enumerated. Otherwise, an initial nmap scan is run, followed by
> corresponding tool chains configured based on regex matching of open ports, finishing with a full
> nmap scan checking all ports.

> ScanClass &nbsp;-&nbsp; The scan process service handler class, which maps the ports of interest
> to their associated service handler function to later be referenced for execution.

> main &nbsp;-&nbsp; Loads the config file, depending on config file settings, either runs ping scan
> to identify hosts or already has target host in config file, and launches the scan process on 
> target hosts based on the available number of cpu's.

> log_handler &nbsp;-&nbsp; Logging thread that handles multiprocessing logging through the dedicated queue.

-- utils.py --
> cmd_parser &nbsp;-&nbsp; Take input command parsed from yaml file, and parses in any delimiters 
> in the command with passed in variable length parameters.

> ConfigClass &nbsp;-&nbsp; Class to store yaml file configurations that are referenced throughout operations.

> config_input &nbsp;-&nbsp; Prompts user for yaml configuration to use for scan automation.

> error_query &nbsp;-&nbsp; Looks up the errno message to get description.

> file_handler &nbsp;-&nbsp; Read/Write file operation handler for text and yaml file formats.

> logger_config &nbsp;-&nbsp; Retrieves the logging configuration in dict form.

> markdown_formatter &nbsp;-&nbsp; Crawls recursively through output dir and converts text output file into markdown copy.

> print_err &nbsp;-&nbsp; Displays the error message through stderr (standard error) with multiprocessing locking support.

> RegexHandler &nbsp;-&nbsp; Class object to store compiled regex patterns.<br>
> scan_parse &nbsp;-&nbsp;Takes the nmap scan output and performs regex matches to identify open ports.
> The result is returned in a dictionary with mapped comma separated ports. 

> service_handler &nbsp;-&nbsp; Takes passed in service information and executes commands parsed from yaml config file.

> system_cmd &nbsp;-&nbsp; Executes system shell command and returns the output. If improper data type is in command syntax list
> or error occurs during command execution, the error is displayed via stderr and logged, and False is returned to indicated failed operation.

-- tcp_handlers.py, udp_handlers.py, tcp_udp_handlers.py --
> There is around 4 dozen services handled by Pentesters Toolchain, each service has its own handler
> function to parse and execute corresponding commands from the yaml config class. The functions are
> laid out in the same manner as the service layout in this section [Supported Service Ports](#supported-service-ports)

## Exit Codes
-- pentest_automater.py --
> 0 - Successful execution (__main__) <br>
> 1 - Unexpected exception occurred (__main__) <br>
> 2 - If error occurs acquiring targets from YAML config file or initial ping scan fails or error rendering banner (main) <br>
> 3 - If error occurs setting up CIDR subnet ping executor (ping_executor) <br>
> 4 - If initial nmap scan fails or ports in regex scan parse do not properly match assigned keys (scan_process) <br>
> 5 - If service function handler fails due to non-existing key or port fails to convert to int (scan_process)

-- utils.py --
> 6 - If file operation was attempted on non-existing file (error_query) <br>
> 7 - If file operation was attempted on file that user does not have access to (error_query) <br>
> 8 - If IO error occurred during file operation (error_query) <br>
> 9 - If unexpected error occurred during file operation (error_query) <br>
> 10 - If write file operation is attempted with no data to write to the file (file_handler) <br> 
> 11 - If attempting to write data to YAML config file (file_handler) <br>
> 12 - If fatal error occurs attempting to execute command (system_cmd)