# Pentest-Automater


## Prereqs
Written in Python 3.10.6 for Kali Linux Debian-based OS

## Installation
- Run the setup.py script to build a virtual environment and install all external packages in the created venv.

> Examples:<br> 
>       &emsp;&emsp;- Windows:  `python setup.py venv`<br>
>       &emsp;&emsp;- Linux:  `python3 setup.py venv`

- Once virtual env is built traverse to the (Scripts-Windows or bin-Linux) directory in the environment folder just created.
- For Windows, in the venv\Scripts directory, execute `activate` or `activate.bat` script to activate the virtual environment.
- For Linux, in the venv/bin directory, execute `source activate` to activate the virtual environment.
- If for some reason issues are experienced with the setup script, the alternative is to manually create an environment, activate it, then run pip install -r packages.txt in project root.
- To exit from the virtual environment when finished, execute `deactivate`.


## Purpose
The general strategy is to execute offensive tools, writing output to report files.
Then the report file data is read and parsed with compiled regex to reactively call
the next logical tool based on the chain of output created from the previous command.

## Supported Service Ports

### TCP Ports

---
20, 21 - FTP <br>
22 - SSH <br>
23 - Telnet <br>
25, 465, 587, 2525 - SMTP <br>
79 - Finger <br>
80, 443, 8080, 8443 - HTTP/HTTPS <br>
110, 995 - Pop3/Pop3 over TLS <br>
119, 433 - NNTP/NNTPS (Network News Transport Protocol) <br>
143, 993 - IMAP/IMAP over TLS <br>
199 - SNMP Smux <br>
445 - SMB <br>
554 - RTSP (Real Time Streaming Protocol) <br>
631 - Cups <br>
749 - Kerberos (v5 administration and kpasswwd service) <br>
761 - Kerberos (v4 password changing service) <br>
873 - rsync <br>
1025 - NFS or IIS (Indicates Windows operating system) <br>
1433 - MsSQL <br>
1521 - Oracle database <br>
2100 - Oracle XML DB FTP <br>
3306 - MySQL database <br>
3339 - Oracle web interface <br>
3389 - Remote Desktop Protocol <br>
5037, 5555 - ADB (Android Debug Bridge) <br>
5800, 5900 - VNC <br>
5985, 5986 - Winrm (Windows Remote Management) <br>
9389 - ADAC (Active Directory Administrative Center)
<br><br>

### UDP Ports

---
67 - DHCP <br>
69 - TFTP <br>
464 - Kerberos (v5 password changing service) <br>
4444 - Kerberos (v5 ticket conversion service) <br>
5353 - mDNS
<br><br>

### TCP/UDP Ports

---
42 - Windows Internet Name Service (WINS) <br>
53 - DNS <br>
88 - Kerberos (v5 ticket service) <br>
111 - Rpcbind <br>
123 - NTP <br>
135 - MSRPC <br>
137 - Netbios Name Service <br>
139 - Netbios Session Service <br>
161, 162, 10161, 10162 - SNMP <br>
389, 636 - Ldap <br>
750 - Kerberos (v4 ticket service) <br>
751 - Kerberos (v4 admin service) <br>
1030, 1032, 1033, 1038 - (Good indicator of Windows domain) <br>
1748, 1754, 1808, 1809 - Oracle intelligent agent <br>
2049 - NFS <br>
3268,3269 - globalcatLdap <br>
4445 - Upnotifyp <br>
4555 - RSIP <br>
5357 - WSDAPI <br>
5722 - DFSR (Distributed File System Replication) <br>
47001 - Windows Remote Management Service <br>
<br>

## How to use


## Function Layout
-- pentest_automater.py --
> scan_process &nbsp;-&nbsp; Begins by setting up process logging facilities, file paths, and
> directories. If there are no specified ports in config file, nmap scans will be skipped assuming
> the ports have already been enumerated. Otherwise, an initial nmap scan is run, followed by
> corresponding tool chains configured based on regex matching of open ports, finishing with a full
> nmap scan checking all ports.

> ScanClass &nbsp;-&nbsp; The scan process service handler class, which maps the ports of interest
> to their associated service handler function to later be referenced for execution.

> main &nbsp;-&nbsp; Loads the config file, depending on config file settings, either runs ping scan
> to identify hosts or already has target host in config file, and launches the scan process on 
> target hosts based on the available number of cpu's.

> log_handler &nbsp;-&nbsp; Logging thread that handles multiprocessing logging through the dedicated queue.

-- utils.py --
> cmd_parser &nbsp;-&nbsp; Take input command parsed from yaml file, and parses in any delimiters 
> in the command with passed in variable length parameters.

> ConfigClass &nbsp;-&nbsp; Class to store yaml file configurations that are referenced throughout operations.

> config_input &nbsp;-&nbsp; Prompts user for yaml configuration to use for scan automation.

> error_query &nbsp;-&nbsp; Looks up the errno message to get description.

> file_handler &nbsp;-&nbsp; Read/Write file operation handler for text and yaml file formats.

> logger_config &nbsp;-&nbsp; Retrieves the logging configuration in dict form.

> print_err &nbsp;-&nbsp; Displays the error message through stderr (standard error) with multiprocessing locking support.

> RegexHandler &nbsp;-&nbsp; Class object to store compiled regex patterns.<br>
> &emsp; scan_parse &nbsp;-&nbsp;Takes the nmap scan output and performs regex matches to identify open ports.
> The result is returned in a dictionary with mapped comma separated ports. 

> system_cmd &nbsp;-&nbsp; Executes system shell command and returns the output. If improper data type is in command syntax list
> or error occurs during command execution, the error is displayed via stderr and logged, and False is returned to indicated failed operation.

-- tcp_handlers.py, udp_handlers.py, tcp_udp_handlers.py --
> There is around 4 dozen services handled by Pentesters Toolchain, each service has its own handler
> function to parse and execute corresponding commands from the yaml config class. The functions are
> laid out in the same manner as the service layout in this section [Supported Service Ports](#supported-service-ports)

## Exit Codes
-- pentest_automater.py --
> 0 - Successful execution (__main__)
> 1 - Unexpected exception occurred (__main__)
> 2 - If error occurs acquiring targets from YAML config file or initial ping scan fails or error rendering banner (main)
> 3 - If error occurs setting up CIDR subnet ping executor (ping_executor)
> 4 - If initial nmap scan fails or ports in regex scan parse do not properly match assigned keys (scan_process)
> 5 - If service function handler fails due to non-existing key or port fails to convert to int (scan_process)

-- utils.py --
> 6 - If file operation was attempted on non-existing file (error_query)
> 7 - If file operation was attempted on file that user does not have access to (error_query)
> 8 - If IO error occurred during file operation (error_query)
> 9 - If unexpected error occurred during file operation (error_query)
> 10 - If write file operation is attempted with no data to write to the file (file_handler) 
> 11 - If attempting to write data to YAML config file (file_handler)
> 12 - If fatal error occurs attempting to execute command (system_cmd)